<!doctype html>
<html lang="lv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pork — 3. forma</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div class="main" style="max-width:1100px; margin:0 auto;">
  <a class="small-link" href="index.html">← Atpakaļ uz sākumlapu</a>

  <h2 class="title">Publiskā datubāze</h2>
  <p class="subtitle">Šajā datubāzē Tu vari apskatīt pieejamās vielas un aprīkojumu</p>

  <div class="panel">
    <div class="toolbar">
      <input id="search" class="search" type="text" placeholder="Search" />
      <button id="btnAll" class="btn primary" type="button">Rādīt visu</button>
      <button id="btnVielas" class="btn" type="button">Rādīt vielas</button>
      <button id="btnInv" class="btn" type="button">Rādīt aprīkojumu</button>
    </div>

    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nosaukums</th>
          <th>Tips</th>
          <th>Apkakštip</th>
          <th>Skaits</th>
          <th>Svars</th>
          <th>Komentāri</th>
        </tr>
      </thead>
      <tbody id="tbody">
      </tbody>
    </table>
  </div>
</div>

<button class="report">Ziņot par kļūdu</button>

<script>
  let allData = [];
  let currentFilter = "all";

  function setActiveButton(activeId) {
    document.getElementById("btnAll").classList.remove("primary");
    document.getElementById("btnVielas").classList.remove("primary");
    document.getElementById("btnInv").classList.remove("primary");
    document.getElementById(activeId).classList.add("primary");
  }

  function makeRow(item) {
    return `
      <tr>
        <td>${item.uid}</td>
        <td>${item.nosaukums || "-"}</td>
        <td>${item.tips || "-"}</td>
        <td>${item.apakstips || "-"}</td>
        <td>${item.skaits ?? "-"}</td>
        <td>${item.svars || "-"}</td>
        <td>${item.komentari || ""}</td>
      </tr>
    `;
  }

  function renderTable(list) {
    const tbody = document.getElementById("tbody");
    let html = "";
    for (let i = 0; i < list.length; i++) {
      html += makeRow(list[i]);
    }
    tbody.innerHTML = html;
  }

  function applyFilters() {
    const q = document.getElementById("search").value.toLowerCase().trim();

    let filtered = allData;

    if (currentFilter === "vielas") {
      filtered = filtered.filter(x => x.cat === "vielas");
    } else if (currentFilter === "inv") {
      filtered = filtered.filter(x => x.cat === "inv");
    }

    if (q !== "") {
      filtered = filtered.filter(x => {
        const a = (x.nosaukums || "").toLowerCase();
        const b = (x.tips || "").toLowerCase();
        const c = (x.apakstips || "").toLowerCase();
        return a.includes(q) || b.includes(q) || c.includes(q);
      });
    }

    renderTable(filtered);
  }

  async function loadData() {
    const vielasResp = await fetch("vielas.json");
    const invResp = await fetch("inventars.json");

    const vielas = await vielasResp.json();
    const inv = await invResp.json();

    const vielasMapped = vielas.map(v => {
      return {
        cat: "vielas",
        uid: "V-" + v.id,
        nosaukums: v.nosaukums,
        tips: v.tips,
        apakstips: v.apakstips,
        skaits: v.skaits,
        svars: (v.daudzums != null && v.mervienibas) ? (v.daudzums + " " + v.mervienibas) : "-",
        komentari: v.komentari || ""
      };
    });

    const invMapped = inv.map(it => {
      return {
        cat: "inv",
        uid: "I-" + it.id,
        nosaukums: it.nosaukums,
        tips: it.tips,
        apakstips: it.apakstips,
        skaits: it.skaits,
        svars: "-",
        komentari: it.komentari || ""
      };
    });

    allData = vielasMapped.concat(invMapped);

    applyFilters();
  }

  document.getElementById("btnAll").addEventListener("click", function () {
    currentFilter = "all";
    setActiveButton("btnAll");
    applyFilters();
  });

  document.getElementById("btnVielas").addEventListener("click", function () {
    currentFilter = "vielas";
    setActiveButton("btnVielas");
    applyFilters();
  });

  document.getElementById("btnInv").addEventListener("click", function () {
    currentFilter = "inv";
    setActiveButton("btnInv");
    applyFilters();
  });

  document.getElementById("search").addEventListener("input", function () {
    applyFilters();
  });

  loadData();
</script>

</body>
</html>